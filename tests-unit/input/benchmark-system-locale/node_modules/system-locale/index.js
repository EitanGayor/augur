'use strict'

var path = require('path')
var child = require('child_process')



var executeSync = function(file) {
	try {
		var stdout = child.execFileSync(path.join(__dirname, file))
		return stdout.toString().trim()
	} catch (e) {
		throw new Error('Cannot read locale.')
	}
}

var executeAsync = function(file) { new Promise(function(yay, nay) {
	child.execFile(path.join(__dirname, file), function (err, stdout, stderr) {
		if (err || !stdout.toString()) nay(new Error('Cannot read locale.'))
		yay(stdout.toString().trim())
	})
}) }

var locale = function(executeAsync) {
        var execute = executeAsync;
	if (process.platform === 'darwin') return execute('os-x-locale')
	if (process.platform === 'win32') return execute('windows-locale.cmd')
	if (process.platform === 'linux') return execute('linux-locale')
	return Promise.reject('Cannot read locale, unknown operating system.')
}

module.exports = Object.assign(locale, {sync: function() { return locale(executeSync); } })
